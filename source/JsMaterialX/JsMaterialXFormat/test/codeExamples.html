<!doctype html>
<html>
<script>
    var buildMaterialXDocument;
    var travereDocumentTree;
    var Module = {
        postRun: function () {
            console.log("Ready");
            buildMaterialXDocument = function () {
                var mx = MaterialX;
                // Create a document.
                var doc = mx.createDocument();

                // Create a node graph with a single image node and output.
                var nodeGraph = doc.addNodeGraph();
                var image = nodeGraph.addNode('image');
                image.setParameterValuestring('file', 'image1.tif', 'filename');
                var output = nodeGraph.addOutput();
                output.setConnectedNode(image);

                // Create a simple shader interface.
                var simpleSrf = doc.addNodeDef('ND_simpleSrf', 'surfaceshader', 'simpleSrf');
                var diffColor = simpleSrf.setInputValuecolor3('diffColor', new mx.Color3(1.0, 1.0, 1.0));
                var specColor = simpleSrf.setInputValuecolor3('specColor', new mx.Color3(0.0, 0.0, 0.0));
                var roughness = simpleSrf.setParameterValuefloat('roughness', 0.25);

                // Create a material that instantiates the shader.
                var material = doc.addMaterial();
                var refSimpleSrf = material.addShaderRef('SR_simpleSrf', 'simpleSrf');

                // Bind roughness to a new value within this material.
                var bindParam = refSimpleSrf.addBindParam('roughness');
                bindParam.setValuefloat(0.5);

                // Display the value of roughness in the context of this material.
                console.log(roughness.getBoundValue(material).getValueString());
            }

            travereDocumentTree = function () {
                var xmlStr = ' <?xml version="1.0"?>' +
                    '<materialx version="1.37" colorspace="srgb_texture" fileprefix="resources/Images/">' +
                    '<nodegraph name="NG_Greysphere_Calibration">' +
                    '<texcoord name="texcoord1" type="vector2" />' +
                    '<place2d name="place2d" type="vector2">' +
                    '<input name="texcoord" type="vector2" nodename="texcoord1"/>' +
                    '<input name="offset" type="vector2" value="-1.66, -0.49"/>' +
                    '<input name="scale" type="vector2" value="0.21, 0.21"/>' +
                    '<parameter name="pivot" type="vector2" value="0.5, 0.5"/>' +
                    '</place2d>' +
                    '<image name="image1" type="color3">' +
                    '<input name="texcoord" type="vector2" nodename="place2d" />' +
                    '<parameter name="file" type="filename" value="greysphere_calibration.png" />' +
                    '<parameter name="uaddressmode" type="string" value="clamp" />' +
                    '<parameter name="vaddressmode" type="string" value="clamp" />' +
                    '</image>' +
                    '<output name="out1" type="color3" nodename="image1" />' +
                    '</nodegraph>' +
                    '<material name="Greysphere_Calibration">' +
                    '<shaderref name="SR_Greysphere_Calibration" node="standard_surface">' +
                    '<bindinput name="base" type="float" value="1.0" />' +
                    '<bindinput name="base_color" type="color3" nodegraph="NG_Greysphere_Calibration" output="out1" />' +
                    '<bindinput name="diffuse_roughness" type="float" value="0"/>' +
                    '<bindinput name="specular" type="float" value="1"/>' +
                    '<bindinput name="specular_color" type="color3" value="1, 1, 1"/>' +
                    '<bindinput name="specular_roughness" type="float" value="0.7"/>' +
                    '<bindinput name="specular_IOR" type="float" value="1.5"/>' +
                    '</shaderref>' +
                    '</material>' +
                    '</materialx>';

                var mx = MaterialX;

                // Read a document from disk.
                var doc = mx.createDocument();
                mx.readFromXmlString(doc, xmlStr);

                // Traverse the document tree in depth-first order.
                var elements = doc.traverseTree();
                var elem = elements.next();
                while(elem) {                
                    // Display the filename of each image node.
                    if (elem instanceof mx.Node) {
                        var param = elem.getParameter('file');
                        if (param) {
                            filename = param.getValueString();
                            console.log('Image node ' + elem.getName() + ' references ' + filename);
                        }
                    }
                    elem = elements.next();
                }
            }
        }
    };
</script>


<!-- output from em++ -->
<script src="../../MaterialXCore.js"></script>

</html>